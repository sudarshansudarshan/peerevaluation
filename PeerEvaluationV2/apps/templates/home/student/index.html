{% extends 'layouts/base.html' %}

{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<style>
  .upload-area {
  background-color: #f9f9f9;
  transition: background-color 0.3s ease;
}

.upload-area:hover {
  background-color: #f1f1f1;
  cursor: pointer;
}

.upload-area i {
  transition: transform 0.3s ease;
}

.upload-area:hover i {
  transform: scale(1.2);
}

label.text-primary.font-weight-bold {
  cursor: pointer;
  transition: color 0.3s ease;
}

label.text-primary.font-weight-bold:hover {
  color: #0056b3;
}

.card-header.bg-primary {
  background: linear-gradient(90deg, #007bff, #0056b3);
}

.card-header h3 {
  font-size: 1.25rem;
  letter-spacing: 0.5px;
}
.upload-area-hover {
  background-color: #e6f7ff; /* Light blue background when hovering */
  border-color: #007bff; /* Highlight border color */
}

</style>
{% endblock stylesheets %}

{% block content %}

    <!-- Header -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row align-items-center py-4">
            <div class="col-lg-6 col-7">
              <h6 class="h2 text-white d-inline-block mb-0">Student Dashboard</h6>
              <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                  <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
                  <li class="breadcrumb-item"><a href="#">Dashboards</a></li>
                </ol>
              </nav>
            </div>
            <div class="col-lg-6 col-5 text-right">
              <a href="#" class="btn btn-sm btn-neutral">New</a>
              <a href="#" class="btn btn-sm btn-neutral">Filters</a>
            </div>
          </div>
          <!-- Card stats -->
          <div class="row">
            <div class="col-xl-3 col-md-6">
              <div class="card card-stats">
                <!-- Card body -->
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Total Students</h5>
                      <span class="h2 font-weight-bold mb-0">350,897</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-gradient-red text-white rounded-circle shadow">
                        <i class="ni ni-active-40"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6">
              <div class="card card-stats">
                <!-- Card body -->
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Total batches</h5>
                      <span class="h2 font-weight-bold mb-0">2,356</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow">
                        <i class="ni ni-chart-pie-35"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6">
              <div class="card card-stats">
                <!-- Card body -->
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Total Courses</h5>
                      <span class="h2 font-weight-bold mb-0">924</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-gradient-green text-white rounded-circle shadow">
                        <i class="ni ni-money-coins"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-md-6">
              <div class="card card-stats">
                <!-- Card body -->
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <h5 class="card-title text-uppercase text-muted mb-0">Total batches</h5>
                      <span class="h2 font-weight-bold mb-0">49,65%</span>
                    </div>
                    <div class="col-auto">
                      <div class="icon icon-shape bg-gradient-info text-white rounded-circle shadow">
                        <i class="ni ni-chart-bar-32"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Page content -->
    <div class="container-fluid mt--6">
      <div class="row">

        <!-- Course enrollment -->
        <div class="col-xl-8">
          <div class="card" style="height: 485px;">
          <div class="card-header border-0">
            <div class="row align-items-center">
            <div class="col">
              <h3 class="mb-0">Course Enrollment</h3>
            </div>
            </div>
          </div>
          <div class="table-responsive" style="max-height: 350px; overflow-y: auto;">
            <!-- Projects table -->
            <table class="table align-items-center table-flush">
            <thead class="thead-light">
              <tr>
              <th scope="col">Course Name</th>
              <th scope="col">Description</th>
              <th scope="col">Batch</th>
              <th scope="col">Start Date</th>
              <th scope="col">End Date</th>
              <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for course in courses %}
              <tr>
              <td>{{ course.name }}</td>
              <td>{{ course.description }}</td>
              <td>{{ course.batch }}</td>
              <td>{{ course.start_date|date:"M d, Y" }}</td>
              <td>{{ course.end_date|date:"M d, Y" }}</td>
              <td>
                {% if course.is_enrolled %}
                {% if not course.is_accepted %}
                  <form method="POST" action="{% url 'enrollment' %}">
                  {% csrf_token %}
                  <input type="hidden" name="batch_id" value="{{ course.batchID }}">
                  <button type="submit" class="btn btn-sm btn-danger"><i class="fa fa-times"></i> Un-Enroll</button>
                  </form>
                {% else %}
                  <button class="btn btn-sm btn-success"><i class="fa fa-check-circle"></i> Accepted</button>
                {% endif %}
                {% else %}
                <form method="POST" action="{% url 'enrollment' %}">
                  {% csrf_token %}
                  <input type="hidden" name="batch_id" value="{{ course.batchID }}">
                  <button type="submit" class="btn btn-sm btn-primary"><i class="fa fa-check"></i> Enroll</button>
                </form>
                {% endif %}
              </td>
              </tr>
              {% endfor %}
              {% if courses|length == 0 %}
              <tr>
              <td colspan="6" class="text-center">No pending enrollments</td>
              </tr>
              {% endif %}
            </tbody>
            </table>
          </div>
          </div>
        </div>

        <!-- Upload Evaluation -->
        <div class="col-xl-4 col-lg-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-header border-0">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="mb-0">Upload Evaluation</h3>
                </div>
              </div>
            </div>
            <div class="card-body">
              {% if exams|length != 0 %}
              <form class="form-horizontal" method="POST" action="{% url 'upload_evaluation' %}" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Evaluation Selector -->
                <div class="form-group">
                  <label for="exam" class="form-label font-weight-bold">Evaluation for</label>
                  <select id="exam" class="form-control custom-select shadow-sm">
                    {% for exam in exams %}
                      <option value="{{ exam.id }}">{{ exam.batch }}</option>
                    {% endfor %}
                  </select>
                </div>

                <!-- File Upload Section -->
                <div class="form-group">
                  <label class="form-label font-weight-bold">Upload your evaluation</label>
                  <div class="border border-secondary border-dashed text-center py-4 rounded upload-area" id="upload-area">
                    <i class="fas fa-file-pdf text-primary mb-2" style="font-size: 3rem;"></i>
                    <div class="d-flex justify-content-center align-items-center">
                      <label for="evaluationfile" class="text-primary font-weight-bold cursor-pointer">
                        <span>Upload a file</span>
                        <input id="evaluationfile" name="evaluationfile" type="file" class="sr-only" accept=".pdf">
                      </label>
                      <p class="ml-1 mb-0">or drag and drop</p>
                    </div>
                    <p class="small text-muted mb-0">Only PDF files are allowed (Max size: 5MB)</p>
                  </div>
                </div>

                <!-- Submit Button -->
                <div class="text-right">
                  <button type="submit" class="btn btn-sm btn-primary shadow">
                    <i class="fas fa-cloud-upload-alt mr-1"></i>Submit
                  </button>
                </div>
              </form>
              {% else %}
              <!-- No Evaluations Placeholder -->
              <div class="text-center py-5">
                <i class="fas fa-clipboard-list text-muted mb-3" style="font-size: 3rem;"></i>
                <h4 class="text-secondary">No evaluations available</h4>
              </div>
              {% endif %}
            </div>
          </div>
        </div>


      </div>
      <div class="row">
        <div class="col-xl-12">
          <div class="card">
          <div class="card-header border-0">
            <div class="row align-items-center">
            <div class="col">
              <h3 class="mb-0">Lecture Evaluation</h3>
            </div>
            </div>
          </div>
          <div class="card-body">
            <form>
            <!-- Today's Topic -->
            <div class="form-group">
              <label for="todaysTopic">Today's Topics</label>
              <select class="form-control" id="todaysTopic">
              <option>Introduction to Python</option>
              <option>Introduction to Django</option>
              <option>Introduction to Flask</option>
              <option>Introduction to FastAPI</option>
              <option>Introduction to Django REST Framework</option>
              </select>
            </div>

            <!-- Takeaways from Today's Lecture -->
            <div class="form-group">
              <label for="lectureTakeaways">What were your takeaways from today's lecture?</label>
              <textarea class="form-control" id="lectureTakeaways" rows="3" placeholder="Write your takeaways here..."></textarea>
            </div>

            <!-- Explore More -->
            <div class="form-group">
              <label for="exploreMore">Go explore the internet and find out more about today's topic</label>
              <textarea class="form-control" id="exploreMore" rows="3" placeholder="Write your findings here..."></textarea>
            </div>

            <!-- Submit Button -->
            <div class="text-right">
              <button type="submit" class="btn btn-sm btn-primary">Submit</button>
            </div>
            </form>
          </div>
          </div>
        </div>
      </div>

      {% include "includes/footer.html" %}

    </div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}

  <script>
  // Select the upload area, file input, and file name display container
  const uploadArea = document.querySelector('.upload-area');
  const fileInput = document.querySelector('#evaluationfile');
  const fileNameDisplay = document.createElement('p');

  // Style the file name display
  fileNameDisplay.classList.add('small', 'text-muted', 'mb-0', 'font-weight-bold');
  fileNameDisplay.textContent = 'No file selected yet.';
  uploadArea.appendChild(fileNameDisplay);

  // Prevent default behaviors for drag events
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
    uploadArea.addEventListener(event, e => e.preventDefault());
    uploadArea.addEventListener(event, e => e.stopPropagation());
  });

  // Add styles for drag events
  ['dragenter', 'dragover'].forEach(event => {
    uploadArea.addEventListener(event, () => {
      uploadArea.classList.add('upload-area-hover');
    });
  });

  ['dragleave', 'drop'].forEach(event => {
    uploadArea.addEventListener(event, () => {
      uploadArea.classList.remove('upload-area-hover');
    });
  });

  // Handle file drop
  uploadArea.addEventListener('drop', event => {
    const files = event.dataTransfer.files; // Get the dropped files
    if (files.length) {
      const file = files[0];
      // Validate the file type
      if (file.type === 'application/pdf') {
        // Update the file input with the dropped file
        fileInput.files = files;
        // Show the file name in the HTML
        fileNameDisplay.textContent = `Selected File: ${file.name}`;
        fileNameDisplay.classList.remove('text-danger');
        fileNameDisplay.classList.add('text-success');
      } else {
        // Display error message
        fileNameDisplay.textContent = 'Error: Only PDF files are allowed.';
        fileNameDisplay.classList.remove('text-success');
        fileNameDisplay.classList.add('text-danger');
      }
    }
  });

  // Handle file input change (if user selects a file via the input)
  fileInput.addEventListener('change', event => {
    const file = event.target.files[0];
    if (file) {
      // Validate the file type
      if (file.type === 'application/pdf') {
        fileNameDisplay.textContent = `Selected File: ${file.name}`;
        fileNameDisplay.classList.remove('text-danger');
        fileNameDisplay.classList.add('text-success');
      } else {
        // Display error message and reset input
        fileInput.value = ''; // Clear the invalid input
        fileNameDisplay.textContent = 'Error: Only PDF files are allowed.';
        fileNameDisplay.classList.remove('text-success');
        fileNameDisplay.classList.add('text-danger');
      }
    } else {
      fileNameDisplay.textContent = 'No file selected yet.';
      fileNameDisplay.classList.remove('text-danger', 'text-success');
    }
  });
</script>


  <script src="/static/assets/vendor/chart.js/dist/Chart.min.js"></script>
  <script src="/static/assets/vendor/chart.js/dist/Chart.extension.js"></script>

{% endblock javascripts %}
